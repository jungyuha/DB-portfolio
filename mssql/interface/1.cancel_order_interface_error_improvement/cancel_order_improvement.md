# 주문취소 인터페이스 오류 해결

## \[1] 변경된 부분

### 1. 인터페이스 상태 추가

주문 인터페이스 상태를 다음 값을 기준으로 구성한다.(총 3가지)

1. NULL(**진행전**) : 인터페이스 이전 상태
2. **M(진행중) : 인터페이스 진행중 상태 <= ⭐️ 해당 상태값을 추가함 ⭐️**
3. 인터페이스 일시(**진행완료**) : 인터페이스 완료 (ex . 202303051334300)

참고로 변경전 주문 인터페이스 상태 종류는 다음 2가지로 구성되어있었다.

1. NULL(**진행전**)
2. 인터페이스 일시(**진행완료**)

### 2. 주문 취소 프로세스 변경

주문 취소시 인터페이스 상태가 'M'인 주문(**진행중**)은 취소하지 않는다.

## \[2] 개선된 인터페이스 과정

### 1. 트랜잭션 1 : 인터페이스 대상 주문을 조회하여 커서에 담는다.

<figure><img src="../../../.gitbook/assets/image (5).png" alt=""><figcaption></figcaption></figure>

#### 💡변경 부분

1.  **인터페이스 대상 주문 조회시 '인터페이스 진행중'인 주문도 조회한다.**

    * 직전 배치때 인터페이스 진행중에 오류가 생겨 인터페이스 완료 처리가 되지 않은 주문들도 존재할 수 있기 때문이다.
    * 뿐만 아니라 **'인터페이스 진행중'인 주문들은 모두 인터페이스 '대상' 주문**이므로 완료처리 될때까지 인터페이스를 시도해야 한다.



### 2. 트랜잭션 2 : 인터페이스 최종 대상 주문을 선별한다.

<figure><img src="../../../.gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>

#### 💡변경 부분

1. **인터페이스 대상 주문 조회시 '인터페이스 진행중'인 주문도 조회한다.**
   * 직전 배치때 인터페이스 진행중에 오류가 생겨 인터페이스 완료 처리가 되지 않은 주문들도 존재할 수 있기 때문이다.
   * 뿐만 아니라 **'인터페이스 진행중'인 주문들은 모두 인터페이스 '대상' 주문**이므로 완료처리 될때까지 인터페이스를 시도해야 한다.
2. **해당 주문의 인터페이스 상태를 'M'으로 업데이트한다. <= ⭐️ 해당 상태값을 추가함 ⭐️**

### 3. 트랜잭션 3 : 주문 상태를 인터페이스 완료 상태로 변경한다.

<figure><img src="../../../.gitbook/assets/image (6).png" alt=""><figcaption></figcaption></figure>
